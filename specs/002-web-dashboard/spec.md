# Feature Specification: Admin Web Dashboard for Lukas the Bear

**Feature Branch**: `002-web-dashboard`
**Created**: 2025-10-28
**Status**: Draft
**Input**: User description: "I would like you to extend this project with a simple web dashboard to monitor the activity of Lukas The Chat Bear. This dashboard should have to main functionalities: monitoring and control. In terms of the monitoring I want it to be able to access the database and show the various elements of the database. For example in one tab/section it should display the history of the generated images. Then there should be an overview of the scheduled events and when they are supposed to happen as well as a history. There should also be a general activtiy log - a list of the past messages that were sent by Lukas (also to whom). The control part should expose an interface which should allow admins to trigger certain events manually. For example to trigger the posting of an image manually. To manually trigger the next sending of a random message to a user and so on."

## Clarifications

### Session 2025-10-28

- Q: How should admins authenticate to access the dashboard? → A: Single shared admin password configured via Docker environment variable (DASHBOARD_ADMIN_PASSWORD). No per-user accounts or database tracking needed.
- Q: How long should authenticated sessions remain valid? → A: Sessions remain valid until browser is closed (no timeout/expiration management needed for simplicity).
- Q: How should the dashboard be deployed in the Docker environment? → A: Separate container in docker-compose with its own Dockerfile (follows existing multi-container pattern).
- Q: How should real-time updates be implemented for activity logs? → A: Periodic polling every 5-10 seconds (simple HTTP requests, meets 10-second update requirement).
- Q: How should manual control actions be logged for audit trail? → A: Log to existing scheduled_tasks table with task_type indicating manual trigger (e.g., "manual_image", "manual_dm") and metadata field storing action parameters.

## User Scenarios & Testing

### User Story 1 - View Activity Logs (Priority: P1)

As an admin, I want to view a comprehensive activity log of all messages sent by Lukas so I can monitor bot interactions and troubleshoot issues.

**Why this priority**: Activity logs are the foundation of monitoring. Without visibility into what the bot is doing, admins cannot diagnose problems or verify correct behavior. This is the core monitoring capability that enables all troubleshooting.

**Independent Test**: Can be fully tested by logging into the dashboard, navigating to the activity log section, and verifying that recent bot messages are displayed with timestamps, recipients, and message content. Delivers immediate value by providing visibility into bot activity.

**Acceptance Scenarios**:

1. **Given** I am logged in as an admin, **When** I navigate to the Activity Log tab, **Then** I see a chronological list of messages sent by Lukas including timestamp, recipient, channel/DM indicator, and message preview
2. **Given** the activity log is displayed, **When** I click on a message entry, **Then** I see the full message content, conversation context, and any tool invocations that occurred
3. **Given** there are many messages in the log, **When** I apply filters by date range or recipient, **Then** the log updates to show only matching messages
4. **Given** I am viewing the activity log, **When** I refresh the page, **Then** I see the most recent messages at the top without losing my position

---

### User Story 2 - View Generated Images History (Priority: P2)

As an admin, I want to view all images generated by Lukas including their prompts and posting history so I can review the visual content the bot is creating.

**Why this priority**: Image generation is a key feature that consumes API credits and produces public-facing content. Admins need visibility to ensure appropriate content generation and track usage costs.

**Independent Test**: Can be fully tested by navigating to the Images section, seeing a gallery of previously generated images with their metadata, and verifying that clicking an image shows full details including generation prompt, timestamp, and where it was posted. Delivers value by enabling content review and cost monitoring.

**Acceptance Scenarios**:

1. **Given** I am logged in as an admin, **When** I navigate to the Generated Images tab, **Then** I see a grid/gallery of all images generated by Lukas with thumbnails
2. **Given** the image gallery is displayed, **When** I click on an image thumbnail, **Then** I see the full image, generation prompt used, timestamp, status (posted/failed), and the channel it was posted to
3. **Given** I am viewing the images section, **When** I filter by date range or status, **Then** the gallery updates to show only matching images
4. **Given** an image failed to post, **When** I view its details, **Then** I see the error message that caused the failure

---

### User Story 3 - View Scheduled Events (Priority: P3)

As an admin, I want to view all upcoming scheduled events and their history so I can understand what the bot will do next and verify past scheduled actions.

**Why this priority**: Understanding the bot's schedule helps admins coordinate bot activity with team events and troubleshoot timing issues. However, this is less critical than seeing what the bot has already done (activity logs) or monitoring expensive operations (images).

**Independent Test**: Can be fully tested by navigating to the Scheduled Events section and seeing both upcoming scheduled tasks (reminders, random DMs, image posts) and completed task history. Delivers value by making the bot's future behavior predictable.

**Acceptance Scenarios**:

1. **Given** I am logged in as an admin, **When** I navigate to the Scheduled Events tab, **Then** I see two sections: "Upcoming Events" and "Completed Events"
2. **Given** I am viewing upcoming events, **When** I look at each event, **Then** I see the event type (reminder, random DM, image post), scheduled time, target (user/channel), and status (pending)
3. **Given** I am viewing completed events, **When** I look at each event, **Then** I see the same information plus execution timestamp and status (completed/failed/cancelled)
4. **Given** there are multiple scheduled events, **When** I sort by scheduled time, **Then** events are arranged chronologically with soonest first

---

### User Story 4 - Manually Trigger Image Generation (Priority: P4)

As an admin, I want to manually trigger Lukas to generate and post an image on demand so I can create content for special occasions without waiting for the scheduled interval.

**Why this priority**: Manual controls add convenience but are not essential for day-to-day monitoring. Admins can already trigger images via Slack commands, so this provides an alternative interface rather than new capability.

**Independent Test**: Can be fully tested by clicking a "Generate Image" button in the dashboard, optionally specifying a theme and target channel, and verifying that the image is generated and posted. Delivers value by providing a web-based alternative to Slack commands.

**Acceptance Scenarios**:

1. **Given** I am logged in as an admin, **When** I navigate to the Manual Controls section, **Then** I see a "Generate Image" button with optional fields for theme and target channel
2. **Given** I click "Generate Image" without specifying options, **When** the request completes, **Then** an image is generated with the default seasonal theme and posted to the default channel
3. **Given** I specify a theme (e.g., "celebration") and channel, **When** I click "Generate Image", **Then** an image matching that theme is posted to the specified channel
4. **Given** image generation is triggered, **When** I view the Generated Images section, **Then** the new image appears in the gallery within 30 seconds

---

### User Story 5 - Manually Trigger Random DM (Priority: P5)

As an admin, I want to manually trigger Lukas to send a random proactive DM to a team member so I can test the feature or initiate engagement outside the normal schedule.

**Why this priority**: This is a convenience feature for testing and special cases. The automatic scheduling already handles the primary use case, making manual triggering a low-priority enhancement.

**Independent Test**: Can be fully tested by clicking a "Send Random DM" button, optionally selecting a specific user, and verifying that Lukas sends a proactive message. Delivers value by enabling on-demand testing and special engagement.

**Acceptance Scenarios**:

1. **Given** I am logged in as an admin, **When** I navigate to the Manual Controls section, **Then** I see a "Send Random DM" button with an optional user selector
2. **Given** I click "Send Random DM" without selecting a user, **When** the request completes, **Then** Lukas sends a proactive DM to a randomly selected active team member
3. **Given** I select a specific user and click "Send Random DM", **When** the request completes, **Then** Lukas sends a proactive DM to that specific user
4. **Given** a random DM is triggered, **When** I view the Activity Log, **Then** the DM appears in the log with a "manually triggered" indicator

---

### Edge Cases

- What happens when someone attempts to access the dashboard with an incorrect password?
- What happens when DASHBOARD_ADMIN_PASSWORD environment variable is not set or empty?
- How does the dashboard handle when the database is temporarily unavailable?
- What happens if an admin tries to trigger an image generation but the OpenAI API key is missing or invalid?
- How does the system handle concurrent manual triggers (e.g., two admins click "Generate Image" simultaneously)?
- What happens when filtering activity logs by a date range that contains thousands of messages?
- How does the dashboard display very long messages or messages with special formatting/emojis?
- What happens when an admin tries to manually trigger a DM but all team members are inactive or unavailable?
- How does the system handle scheduled events that were cancelled or failed to execute?

## Requirements

### Functional Requirements

- **FR-001**: System MUST display a chronological activity log of all messages sent by Lukas showing timestamp, recipient identifier, channel/DM type, and message content
- **FR-002**: System MUST provide filtering capabilities for activity logs by date range, recipient, and message type (DM/channel/thread)
- **FR-003**: System MUST display a gallery of all generated images with thumbnails, showing generation timestamp, prompt used, posting status, and target channel
- **FR-004**: System MUST show detailed information for each image including full resolution, generation parameters, posting success/failure status, and error messages for failed attempts
- **FR-005**: System MUST display two sections for scheduled events: upcoming (pending) and completed/historical events
- **FR-006**: System MUST show for each scheduled event: event type, scheduled time, target (user/channel), current status, and execution timestamp for completed events
- **FR-007**: System MUST allow sorting scheduled events by time (chronological and reverse chronological)
- **FR-008**: System MUST provide manual control to trigger image generation with optional theme and target channel parameters
- **FR-009**: System MUST provide manual control to trigger random DM with optional user selection
- **FR-010**: System MUST require password authentication using a shared admin password configured via DASHBOARD_ADMIN_PASSWORD environment variable
- **FR-011**: System MUST create and maintain authenticated sessions after successful password entry that remain valid until browser is closed
- **FR-012**: System MUST automatically update activity logs via periodic polling (every 5-10 seconds) without requiring manual page refresh
- **FR-013**: System MUST handle pagination for large datasets (activity logs with >100 entries, image galleries with >50 images)
- **FR-014**: System MUST provide feedback on manual control actions showing success/failure status and any error messages
- **FR-015**: System MUST log all manual control actions to the scheduled_tasks table with task_type indicating manual trigger and metadata field storing action parameters for audit trail
- **FR-016**: System MUST display user-friendly error messages when database queries fail or external services are unavailable

### Key Entities

- **ActivityLogEntry**: Represents a single bot message with timestamp, recipient (user ID), channel type (DM/channel/thread), channel ID, message content, token count, and associated conversation ID
- **GeneratedImage**: Represents an AI-generated image with ID, generation timestamp, prompt used, image URL/path, posting status (posted/failed/pending), target channel, and error message (if failed)
- **ScheduledEvent**: Represents both scheduled and manual tasks with task type (reminder/random_dm/image_post/manual_image/manual_dm), scheduled time, target type (user/channel), target ID, execution status (pending/completed/failed/cancelled), execution timestamp, and metadata (task-specific parameters including action source)
- **TeamMember**: Represents a user with Slack user ID, display name, and activity metrics (used for displaying recipients in activity logs and for user selection in manual DM triggers)
- **DashboardSession**: Represents an authenticated session with session ID and login timestamp (remains valid until browser closed, no expiration tracking needed)

## Success Criteria

### Measurable Outcomes

- **SC-001**: Admins can view the complete activity history of Lukas within 2 seconds of loading the activity log tab
- **SC-002**: Dashboard displays generated images in under 3 seconds when viewing the images gallery
- **SC-003**: Admins can successfully filter activity logs by date range and see results within 1 second
- **SC-004**: Manual image generation completes and provides feedback to the admin within 30 seconds
- **SC-005**: Dashboard correctly displays all scheduled events (upcoming and historical) with accurate timestamps and status
- **SC-006**: 100% of manual control actions (image generation, random DM) provide clear success or failure feedback to the admin
- **SC-007**: Dashboard remains accessible and functional even when displaying datasets with 1000+ activity log entries or 100+ generated images
- **SC-008**: Unauthorized access attempts are blocked and admins receive clear authentication prompts
- **SC-009**: Dashboard updates activity logs within 10 seconds of new bot activity without requiring manual refresh
- **SC-010**: Admins can complete common monitoring tasks (check recent activity, review latest image, view upcoming events) in under 1 minute

## Assumptions

- Authentication uses a single shared password configured via DASHBOARD_ADMIN_PASSWORD environment variable in Docker
- Dashboard will be a web application accessible via browser (standard HTTP/HTTPS)
- Dashboard will run as a separate container in docker-compose with its own Dockerfile, reading from the same SQLite database as the main bot via shared volume
- Dashboard container will expose an HTTP port (e.g., 8080) for browser access
- Activity log updates will be implemented using periodic polling (browser requests updates every 5-10 seconds via standard HTTP)
- Image thumbnails can be generated from the stored full-resolution images or cached separately
- Activity logs will include all messages stored in the existing `messages` table
- Manual controls will invoke the same service methods used by Slack command handlers
- Date/time displays will use the server's timezone (typically UTC) or admin's browser timezone
- Dashboard will support modern browsers (Chrome, Firefox, Safari, Edge - last 2 versions)
- No per-user account management needed - single shared password provides sufficient access control for small admin teams

## Dependencies

- Existing SQLite database schema (tables: messages, conversations, generated_images, scheduled_tasks, team_members, configurations)
- Existing service layer for triggering bot actions (ImageService, ProactiveDMService, SchedulerService)
- Docker and docker-compose for container orchestration
- Shared volume configuration in docker-compose for database access between bot and dashboard containers
- DASHBOARD_ADMIN_PASSWORD environment variable must be set in Docker configuration
- OpenAI API key must be configured for image generation manual controls to function

## Security Considerations

- Dashboard must enforce password authentication before serving any content
- Session management required to maintain authenticated state (sessions remain valid until browser closed for simplicity)
- Manual control actions logged to scheduled_tasks table with task_type (manual_image/manual_dm), timestamp, and metadata for audit trail
- Dashboard should rate-limit manual control actions to prevent abuse (max 10 image generations per hour per session, max 10 DM triggers per hour per session)
- Dashboard should rate-limit general API requests to prevent DoS (max 100 requests per minute per IP address)
- Database queries must use parameterized queries to prevent SQL injection
- Sensitive information (API keys, DASHBOARD_ADMIN_PASSWORD value, internal IDs) should not be exposed in dashboard UI
- DASHBOARD_ADMIN_PASSWORD should be set to a strong password (minimum 12 characters recommended)
- Admins should be advised to close browser when finished to invalidate sessions

## Out of Scope

- User management interface (adding/removing admins, managing permissions)
- Editing historical messages or scheduled events
- Detailed analytics and metrics dashboards (charts, graphs, trends)
- Mobile app version of the dashboard
- Multi-user collaboration features (comments, annotations)
- Export functionality for logs or images
- Integration with external monitoring tools (Grafana, Datadog, etc.)
- Custom theming or white-labeling of the dashboard
- Bulk operations (e.g., delete multiple images, cancel multiple scheduled events)
- Real-time chat interface to interact with Lukas through the dashboard
